# Análisis de Comportamiento de Funciones Dinámicas

## Tipos de Retorno por Función y Caso de Uso

### INDEX Function - Comportamientos Diversos

#### 1. Valor Simple (Single Value)
```excel
=INDEX(A1:C3, 2, 2)  → Retorna: Valor en B2 (número, texto, boolean)
```
**Tipo de retorno**: Valor nativo (int, str, bool, float)

#### 2. Array Completo - Fila (Entire Row)
```excel
=INDEX(A1:C3, 2, 0)  → Retorna: Array de fila 2 completa
```
**Tipo de retorno**: Array horizontal [val1, val2, val3]

#### 3. Array Completo - Columna (Entire Column)
```excel
=INDEX(A1:C3, 0, 2)  → Retorna: Array de columna 2 completa
```
**Tipo de retorno**: Array vertical [[val1], [val2], [val3]]

#### 4. Errores de Referencia
```excel
=INDEX(A1:C3, 5, 2)  → Retorna: #REF! (fila fuera de rango)
=INDEX(A1:C3, 2, 5)  → Retorna: #REF! (columna fuera de rango)
```
**Tipo de retorno**: RefExcelError

#### 5. Errores de Valor
```excel
=INDEX(A1:C3, 0, 0)  → Retorna: #VALUE! (ambos parámetros cero)
=INDEX(A1:C3, -1, 2) → Retorna: #VALUE! (índice negativo)
```
**Tipo de retorno**: ValueExcelError

### OFFSET Function - Comportamientos de Referencia

#### 1. Referencia Simple (Single Cell Reference)
```excel
=OFFSET(A1, 1, 1)     → Retorna: Referencia a B2
```
**Tipo de retorno**: String reference "B2" o valor resuelto

#### 2. Referencia de Rango (Range Reference)
```excel
=OFFSET(A1, 1, 1, 2, 2) → Retorna: Referencia a B2:C3
```
**Tipo de retorno**: String reference "B2:C3" o Array de valores

#### 3. Offset con Dimensiones Originales
```excel
=OFFSET(A1:B2, 1, 1)  → Retorna: Referencia a B2:C3 (mantiene 2x2)
```
**Tipo de retorno**: String reference o Array preservando dimensiones

#### 4. Errores de Límites
```excel
=OFFSET(A1, -1, 0)    → Retorna: #REF! (fuera de hoja)
=OFFSET(A1, 0, -1)    → Retorna: #REF! (fuera de hoja)
```
**Tipo de retorno**: RefExcelError

#### 5. Errores de Parámetros
```excel
=OFFSET(A1, "text", 1) → Retorna: #VALUE! (parámetro no numérico)
```
**Tipo de retorno**: ValueExcelError

### INDIRECT Function - Comportamientos de Resolución

#### 1. Referencia Simple Válida
```excel
=INDIRECT("B2")       → Retorna: Valor en B2
=INDIRECT("Sheet2!A1") → Retorna: Valor en Sheet2!A1
```
**Tipo de retorno**: Valor resuelto (int, str, bool, float)

#### 2. Referencia de Rango Válida
```excel
=INDIRECT("A1:C3")    → Retorna: Array de valores del rango
```
**Tipo de retorno**: Array bidimensional

#### 3. Referencia Dinámica (desde celda)
```excel
=INDIRECT(A1)         → Si A1="B2", retorna valor en B2
```
**Tipo de retorno**: Valor resuelto según contenido de A1

#### 4. Errores de Nombre
```excel
=INDIRECT("InvalidRef") → Retorna: #NAME! (referencia inválida)
=INDIRECT("Sheet99!A1") → Retorna: #NAME! (hoja inexistente)
```
**Tipo de retorno**: NameExcelError

#### 5. Errores de Valor
```excel
=INDIRECT("")         → Retorna: #VALUE! (texto vacío)
=INDIRECT(A1, FALSE)  → Retorna: #VALUE! (R1C1 no soportado)
```
**Tipo de retorno**: ValueExcelError

## Casos de Uso Combinados

### 1. INDEX + OFFSET (Navegación Dinámica)
```excel
=INDEX(A1:E5, OFFSET(A10, 0, 0), 2)
```
**Comportamiento**: OFFSET retorna número, INDEX usa ese número como índice

### 2. INDIRECT + INDEX (Referencias Dinámicas)
```excel
=INDEX(INDIRECT("A1:E5"), 2, 3)
```
**Comportamiento**: INDIRECT retorna array, INDEX extrae valor específico

### 3. Funciones Anidadas con Arrays
```excel
=SUM(INDEX(A1:E5, 0, 2))
```
**Comportamiento**: INDEX retorna array de columna, SUM procesa el array

## Implicaciones para Generación de Excel

### Datos de Prueba Necesarios

#### Hoja "Data" - Datos Base
```
    A      B      C      D      E
1   Name   Age    Score  Grade  Active
2   Alice  25     85     A      TRUE
3   Bob    30     92     A      FALSE
4   Charlie 22    78     B      TRUE
5   Diana  28     88     A      FALSE
6   Eve    35     95     A      TRUE
```

#### Hoja "References" - Referencias Dinámicas
```
    A      B      C
1   B2     A1:C3  Sheet2!A1
2   2      3      InvalidRef
3   0      -1     ""
```

#### Hoja "Tests" - Casos de Prueba
```
A1: =INDEX(Data!A1:E6, 2, 2)           → 25 (valor simple)
A2: =INDEX(Data!A1:E6, 2, 0)           → Array fila (Alice, 25, 85, A, TRUE)
A3: =INDEX(Data!A1:E6, 0, 2)           → Array columna (Age, 25, 30, 22, 28, 35)
A4: =INDEX(Data!A1:E6, 7, 2)           → #REF! (fila fuera de rango)
A5: =INDEX(Data!A1:E6, 0, 0)           → #VALUE! (ambos cero)

B1: =OFFSET(Data!A1, 1, 1)             → Referencia B2 o valor 25
B2: =OFFSET(Data!A1, 1, 1, 2, 2)       → Referencia B2:C3 o Array 2x2
B3: =OFFSET(Data!A1:B2, 1, 1)          → Referencia B2:C3 o Array 2x2
B4: =OFFSET(Data!A1, -1, 0)            → #REF! (fuera de límites)
B5: =OFFSET(Data!A1, "text", 1)        → #VALUE! (parámetro inválido)

C1: =INDIRECT("Data!B2")               → 25 (valor resuelto)
C2: =INDIRECT("Data!A1:C3")            → Array 3x3
C3: =INDIRECT(References!A1)           → Valor dinámico según A1
C4: =INDIRECT("InvalidSheet!A1")       → #NAME! (hoja inexistente)
C5: =INDIRECT("")                      → #VALUE! (texto vacío)
```

## Estrategia de Implementación

### Fase 1: Valores Simples
- INDEX con coordenadas específicas → valores únicos
- INDIRECT con referencias simples → valores únicos

### Fase 2: Arrays y Rangos
- INDEX con parámetros 0 → arrays
- OFFSET con dimensiones → referencias de rango
- INDIRECT con rangos → arrays

### Fase 3: Manejo de Errores
- Validación de límites → #REF!
- Validación de parámetros → #VALUE!
- Validación de referencias → #NAME!

### Fase 4: Casos Combinados
- Funciones anidadas
- Referencias dinámicas
- Interacción con otras funciones Excel