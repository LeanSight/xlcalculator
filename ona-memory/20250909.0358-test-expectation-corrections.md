# Test Expectation Corrections - ATDD Compliance

## Issue Analysis

Based on Excel behavior analysis, the following tests have wrong expectations that don't match official Excel documentation:

### 1. Complex Combinations N3
**Current Excel Formula**: `=INDIRECT("Data!" & "A" & INDEX(Data!B1:B6, 2, 1))`
**Current Expectation**: 'Alice'
**Correct Expectation**: 0

**Analysis**:
1. `INDEX(Data!B1:B6, 2, 1)` returns 25 (value from Data!B2)
2. `"Data!" & "A" & 25` returns "Data!A25"
3. `INDIRECT("Data!A25")` returns 0 (Data!A25 is empty)
4. Excel behavior: INDIRECT of empty cell returns 0

### 2. Functions with Aggregation O1
**Current Excel Formula**: `=SUM(INDEX(Data!A1:E6, 0, 2))`
**Current Expectation**: 130
**Correct Expectation**: 140

**Analysis**:
1. `INDEX(Data!A1:E6, 0, 2)` returns column 2: [Age, 25, 30, 35, 28, 22]
2. `SUM` ignores text "Age" and sums numbers: 25+30+35+28+22 = 140
3. Excel behavior: SUM ignores text values in arrays

## Required Corrections

### JSON Design File Corrections

1. **Complex Combinations N3**:
   ```json
   {
     "cell": "N3",
     "formula": "=INDIRECT(\"Data!\" & \"A\" & INDEX(Data!B1:B6, 2, 1))",
     "expected_value": 0,
     "expected_type": "number",
     "description": "Referencia dinámica compleja - INDIRECT de celda vacía"
   }
   ```

2. **Functions with Aggregation O1**:
   ```json
   {
     "cell": "O1", 
     "formula": "=SUM(INDEX(Data!A1:E6, 0, 2))",
     "expected_value": 140,
     "expected_type": "number",
     "description": "SUM con INDEX array - suma correcta"
   }
   ```

## ATDD Compliance

Following ATDD criteria:
- ✅ **Excel behavior verified** against official documentation
- ✅ **Test expectations corrected** to match Excel behavior
- ✅ **Implementation remains unchanged** (already correct)
- ✅ **Only wrong expectations fixed** (not implementation bugs)

## Next Steps

1. Update JSON design file with correct expectations
2. Regenerate Excel files with corrected formulas
3. Regenerate test files with corrected expectations
4. Verify tests pass with corrected expectations