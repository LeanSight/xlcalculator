# Análisis de Nomenclatura: SheetReference vs SheetCellAddress vs SheetCellReference

## Pregunta del Usuario
¿Cuál es el nombre más semántico? ¿SheetReference, SheetCellAddress, o SheetCellReference? ¿Cuál usa el modelo de objetos oficial de Excel?

## Análisis Semántico

### Problema Conceptual Identificado
El usuario señala una brecha importante: **"cuando no está el sheet explícitamente, entonces el sheet es la hoja actual"**

Esto revela que nuestro concepto actual es **incompleto** porque:
1. **No captura el contexto**: ¿Cuál es la "hoja actual"?
2. **Asume default estático**: Siempre `Sheet1` no es correcto
3. **Pierde información**: No distingue entre explícito vs implícito

## Investigación: Modelo de Objetos de Excel

### Terminología Oficial de Microsoft Excel

#### 1. **Range Object** (Objeto Rango)
```vba
' VBA/Excel Object Model
Dim rng As Range
Set rng = Worksheets("Sheet1").Range("A1")
' Propiedades:
' rng.Address -> "$A$1" 
' rng.Worksheet.Name -> "Sheet1"
' rng.Parent -> Worksheet object
```

#### 2. **Address Property**
```vba
' Diferentes formatos de dirección
rng.Address(False, False) -> "A1"           ' Relativa
rng.Address(True, True)   -> "$A$1"         ' Absoluta  
rng.Address(External:=True) -> "[Workbook.xlsx]Sheet1!$A$1"  ' Externa
```

#### 3. **Reference vs Address**
- **Reference**: Concepto lógico (apunta a algo)
- **Address**: Representación textual de la ubicación

### Terminología en Documentación Excel

#### Microsoft Excel Object Model:
- **Range**: El objeto fundamental
- **Address**: La representación textual
- **Reference**: El concepto de "apuntar a"
- **Cell**: Una celda individual
- **Worksheet**: La hoja

#### Patrones de Naming en Excel API:
```csharp
// Excel Interop (.NET)
Range range = worksheet.get_Range("A1");
string address = range.Address;
Worksheet parent = range.Worksheet;

// Office.js (JavaScript)
let range = context.workbook.worksheets.getItem("Sheet1").getRange("A1");
let address = range.address;  // "Sheet1!A1"
```

## Análisis de Opciones de Nombres

### 1. **SheetReference** ❌
**Problemas:**
- Demasiado genérico
- No indica que es específicamente una celda/rango
- Podría ser referencia a la hoja misma

### 2. **SheetCellAddress** ⚠️
**Problemas:**
- "Address" implica representación textual
- No captura el concepto de referencia lógica
- Limitado a celdas individuales (¿qué pasa con rangos?)

### 3. **SheetCellReference** ✅
**Ventajas:**
- Alineado con terminología Excel
- "Reference" es el concepto correcto
- Extensible a rangos

### 4. **CellReference** (Alternativa) ✅
**Ventajas:**
- Más conciso
- Sheet es parte del contexto, no el concepto principal
- Alineado con Excel Object Model

## Brecha Conceptual Identificada

### Problema: Contexto de Hoja Actual

```python
# Situación actual - INCORRECTA
def parse_sheet_and_address(ref, default_sheet='Sheet1'):
    # Siempre asume Sheet1 como default
    
# Problema real:
# En Excel: =A1 se refiere a A1 en la HOJA ACTUAL
# No siempre es Sheet1
```

### Casos Problemáticos:

#### 1. **Contexto de Evaluación**
```excel
' En Sheet2, la fórmula =A1 se refiere a Sheet2!A1
' NO a Sheet1!A1
```

#### 2. **Referencias Cruzadas**
```excel
' En Sheet1: =Sheet2!A1 + B1
' B1 se refiere a Sheet1!B1 (hoja actual)
' NO a Sheet1!B1 por default estático
```

#### 3. **Fórmulas Complejas**
```excel
' En Sheet3: =SUM(A1:A10) + Sheet1!B1 + C1
' A1:A10 -> Sheet3!A1:A10 (hoja actual)
' C1 -> Sheet3!C1 (hoja actual)
```

## Análisis de la Brecha

### Brecha 1: **Falta de Contexto**
```python
# Actual - sin contexto
ref = parse_sheet_and_address("A1")  # ¿Qué hoja?

# Necesario - con contexto
ref = CellReference.parse("A1", current_sheet="Sheet3")
```

### Brecha 2: **Información Perdida**
```python
# ¿Cómo distinguir entre estos casos?
ref1 = CellReference.parse("Sheet1!A1")  # Explícito
ref2 = CellReference.parse("A1", current_sheet="Sheet1")  # Implícito

# Ambos resultan en sheet="Sheet1", address="A1"
# Pero semánticamente son diferentes
```

### Brecha 3: **Modelo Incompleto**
```python
# Modelo actual - incompleto
@dataclass
class SheetReference:
    sheet: str      # ¿Explícito o implícito?
    address: str    # ¿Relativo o absoluto?

# Modelo necesario - completo
@dataclass  
class CellReference:
    sheet: str
    address: str
    is_sheet_explicit: bool     # ¿Se especificó la hoja?
    current_sheet_context: str  # ¿Cuál era la hoja actual?
```

## Recomendaciones de Nomenclatura

### Nombre Recomendado: **`CellReference`**

**Justificación:**
1. **Alineado con Excel**: Range.Address, Cell Reference
2. **Semánticamente correcto**: Es una referencia a una celda
3. **Extensible**: Puede manejar rangos también
4. **Conciso**: Sheet es contexto, no el concepto principal

### Estructura Recomendada:
```python
@dataclass(frozen=True)
class CellReference:
    """Represents a cell reference in Excel context.
    
    Captures both explicit sheet references (Sheet1!A1) and 
    implicit references (A1) with their evaluation context.
    """
    sheet: str                    # Resolved sheet name
    address: str                  # Cell/range address (A1, A1:B2)
    is_sheet_explicit: bool       # Was sheet explicitly specified?
    
    @classmethod
    def parse(cls, ref: str, current_sheet: str) -> 'CellReference':
        """Parse reference with proper sheet context."""
        # Implementation needed
        
    def to_absolute_address(self) -> str:
        """Return full sheet!address format."""
        return f"{self.sheet}!{self.address}"
        
    def is_same_sheet_as_context(self, context_sheet: str) -> bool:
        """Check if reference is in the same sheet as context."""
        return self.sheet == context_sheet
```

## Conclusión

**Brechas Identificadas:**
1. **Nomenclatura**: `CellReference` es más preciso que `SheetReference`
2. **Contexto faltante**: Necesita `current_sheet` parameter
3. **Información perdida**: Debe distinguir explícito vs implícito
4. **Modelo incompleto**: Falta capturar el contexto de evaluación

**Próximos pasos**: Diseñar `CellReference` que capture correctamente el contexto de hoja actual y distinga entre referencias explícitas e implícitas.